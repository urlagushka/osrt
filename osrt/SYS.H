/******************************************************************************/
/* sys.h                                                                      */
/*                                                                            */
/* Системные функции для OS class A.                                          */
/*                                                                            */
/* Автор:  Кожевников К.А.                                                    */
/*                                                                            */
/* Дата создания:  10 июля 2000 г.                                            */
/******************************************************************************/

#ifndef __SYS_H
#define __SYS_H

#include  <setjmp.h>
#include  "defs.h"
#include  "hardware.h"

/******************************************************************************/
/* Макроопределения                                                           */
/******************************************************************************/

/* Пустой указатель */
#define  _NULL             -1

/******************************************************************************/
/* Определения типов                                                          */
/******************************************************************************/

/* Тип задача */
typedef struct tagTTaskStruct
{
   char link;                    /* следующая задача */
   char eff_priority;            /* эффективный приоритет */
   char priority;                /* исходный приоритет задачи */
   void (*entry) (void);         /* точка входа */
}  TTaskStruct;

/******************************************************************************/
/* Объявления глобальных переменных                                           */
/******************************************************************************/

/* Очередь готовых задач */
extern  TTaskStruct  gTaskQueue[TASK_MAX];

/* Указатель на голову очереди готовых задач */
extern  char gRunningTask;

/* Указатель на первое свободное место в очереди задач */
extern  char gFreeTask;

/* Точка возврата для аварийного завершения OS */
extern  jmp_buf  gReturnSP;

/******************************************************************************/
/* Системные функции                                                          */
/******************************************************************************/

/* Планировщик */
void  _Schedule (char task);

/* Диспетчер задач */
void  _Dispatch (char source);

#endif
